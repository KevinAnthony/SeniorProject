<head>
    <script src="kinetic-v3.6.4.js">
    </script>
    <script>
    	var stage;
    	var wInner;
    	var offset;
    	
    	window.onload = function(){
        	wInner = window.innerWidth - 30;
            stage = new Kinetic.Stage("cont", wInner, 1100);
            var calendarLayer = new Kinetic.Layer();
            
            var divs = 7;	
            offset = 150;
            var topX = wInner / (divs * 2) + 0.5;			//column size / 2 padding on each side
			var topY = offset + 0.5;	
			var width = wInner - 2*topX;
			var height = 810;										//this maps 1 pixel : 1 minute, nifty
		 	var i = 0;
            
            var calBase = new Kinetic.Shape(function(){
            	var context = this.getContext();
                context.beginPath();
				context.rect(topX, topY, width, height);
				context.fillStyle = "#ACC8FF";//"#C9C9C7";
				context.fill();
				context.lineWidth = 3;
				context.strokeStyle = "#4B4B4B";
				context.stroke(); //draw
				
				for(i=1; i<(divs-1); i++){ 									//vertical lines
					//var pos = topX + (i * width/(divs-1)) + 0.5;
					var pos = DayToPixels(i);
					context.moveTo(pos, offset);
					context.lineTo(pos, height + offset);
					context.lineWidth = 2;
					context.strokeStyle = "#7E7E7C"
					context.stroke();
				}
				
				for(i=1; i<=27; i++){										//horizontal lines (ea. 30m), time
					var pos = topY + (i * height/27);
					context.moveTo(topX, pos);
					context.lineTo(topX+width, pos);
					context.lineWidth = 1;
					context.strokeStyle = "#7E7E7C";
					context.stroke();
					
					if(i % 2){												//time, skips the :30s
						var x = topX - 10;
						var time = pos - (offset + 0.5) + 510;				//since pixels map to minutes, 0 time (8:30, 510m) is at the offset
					 	context.fillStyle = "#000000"
						context.font = "11pt Courier";
						context.textAlign = "right"
						var h = Math.floor(time/60);
						
						if(wInner > 1100){								//if window is too small, switch to condensed time (4p, 5p...)
							var m = ((time%60 != 0) ? (":"+ time % 60) : ":00");
							m = m + ((h > 11) ? " pm" : " am" )				//decide am or pm
						} else {
							var m = ((h > 11) ? "p" : "a" )
						}													//problem marking ea 30m, in condensed mode (4p, 4p)
						
						(h > 12) ? (h = h % 12) : 0;						//Comment out for military (24h) time. Fuck yea, military time.

						context.fillText(h + m, x, pos + 4);
					}
				}
            });
 
            calendarLayer.add(calBase);
            stage.add(calendarLayer);
 			
 			var scheduleLayer = new Kinetic.Layer();
 			
 			addBlock(scheduleLayer, 3, 750, 830);
 			//addBlock(scheduleLayer, 2, 2, 0, 1, 3, 20, 1);
	      	/*var circle = new Kinetic.Shape(function(){
                var canvas = this.getCanvas();
                var context = this.getContext();
                context.beginPath();
                context.arc(380, canvas.height / 2, 70, 0, Math.PI * 2, true);
                context.fillStyle = "red";
                context.fill();
                context.lineWidth = 4;
                context.stroke();
            });
 
            circle.on("mouseover", function(){
                writeMessage(messageLayer, "Mouseover circle");
            });
            circle.on("mouseout", function(){
                writeMessage(messageLayer, "Mouseout circle");
            });
            circle.on("mousedown", function(){
                writeMessage(messageLayer, "Mousedown circle");
            });
            circle.on("mouseup", function(){
                writeMessage(messageLayer, "Mouseup circle");
            });
 
            shapesLayer.add(circle);
 
            
            stage.add(messageLayer);*/
            
        };
        
        //start_time, end_time in minutes
		function addBlock(scheduleLayer, day, start_time, end_time){	
 			var block = new Kinetic.Shape(function(){
 				var tX = DayToPixels(day);
 				var tY = TimeToPixels(start_time);
 				var w = DayToPixels(day+1) - tX;
 				var h = TimeToPixels(end_time) - tY;
 				var context = this.getContext();
	            
				context.rect(tX, tY, w, h);
				context.fillStyle = "#c9c9c9";//"#C9C9C7";
				context.fill();4	
				context.lineWidth = 2;
				context.strokeStyle = "#000000";
				/*context.shadowColor = "#000000";
				context.shadowBlur = 10;
				context.shadowOffsetX = 5;
				context.shadowOffsetY = 5;//*/
				context.stroke(); //draw
 			});

 			scheduleLayer.add(block);
 			stage.add(scheduleLayer);
 		};
 
        
        function TimeToPixels(time){
			var position;
        	position = time - (510 - offset);
			
			//console.write(pixies + '\n');
			return position;
        };
        
        function DayToPixels(day){
        	var pixals = 0;
        	pixals += (wInner/14) + day * (wInner/7);
        	return Math.floor(pixals);
        };
        
        //Block size to font size
        //wrap create block
        //How will we pass classes/times, arrays?
    </script>
</head>
<body onmousedown="return false;">
	<button onClick="">Get!</button></br>
	<select>
	  <option value="424">Opt1</option>
	  <option value="310">Opt2</option>
	</select> 
	<button onClick="">Display!</button>
	<button onClick="">Remove!</button>
    <div id="cont">
    </div>
</body>
